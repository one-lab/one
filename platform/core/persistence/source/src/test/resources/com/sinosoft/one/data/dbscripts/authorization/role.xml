<?xml version="1.0" encoding="UTF-8"?>
<dbscripts namespace="role" xmlns="http://www.vmars.org/dbscript" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.vmars.org/dbscript ../../../../dbscript.xsd ">
	<typeAlias alias="Role" type="com.sinosoft.emergency.model.authorization.Role"/>
	<typeAlias alias="VRolePermission" type="com.sinosoft.emergency.model.authorization.VRolePermission"/>
	<dbscript type="sql" id="selectRolesByOrgnizationId" resultClass="Role">
		SELECT * FROM sys_t_role r WHERE r.state='1' and r.orgnization_id=?
	</dbscript>
	<dbscript type="sql" id="countRolesByOrgnizationId">
		SELECT count(id) as count FROM sys_t_role WHERE state='1' and orgnization_id=?
	</dbscript>
	<dbscript type="sql" id="countRolesByStationId">
		SELECT count(r.id) as count FROM sys_t_role r, sys_t_station_role rsr WHERE r.state='1' and r.id=rsr.role_id and rsr.station_id=?
	</dbscript>
	<dbscript type="sql" id="countRolesByStationIdAndConditions">
		SELECT count(r.id) as count FROM sys_t_role r, sys_t_station_role rsr WHERE r.state='1' and r.id=rsr.role_id and rsr.station_id=?
		<ifNotNullCondition property="name">
			and r.name like %name%
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="countRolePermissionByRoleId">
		SELECT count(id) as count FROM sys_t_role_permission WHERE role_id=?
	</dbscript>
	<dbscript type="sql" id="countStationRoleByRoleId">
		SELECT count(id) as count FROM sys_t_station_role WHERE role_id=?
	</dbscript>
	<dbscript type="sql" id="countVRolePermissionsByRoleId">
		select count(role_id) as count from sys_v_role_permissions where role_id=?
	</dbscript>
	<dbscript type="sql" id="countVRolePermissionsByRoleIdAndConditions">
		select count(role_id) as count from sys_v_role_permissions where role_id=?
		<ifNotNullCondition property="name">
			and permission_name like %name%
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="countRolesByConditions">
		SELECT count(id) as count FROM sys_t_role WHERE orgnization_id=? and state='1'
		<ifNotNullCondition property="name">
			and name like %name%
		</ifNotNullCondition>
		<ifNotNullCondition property="type">
			and type = #type#
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="selectRolesByTypeAndOrgnizationId" resultClass="Role">
		SELECT * FROM sys_t_role WHERE state='1' and (type = ? or orgnization_id=?)
	</dbscript>
	<dbscript type="sql" id="selectRolesByConditions" resultClass="Role">
		SELECT * FROM sys_t_role r WHERE orgnization_id=? and r.state='1'
		<ifNotNullCondition property="name">
			and name like %name%
		</ifNotNullCondition>
		<ifNotNullCondition property="type">
			and type = #type#
		</ifNotNullCondition>
	</dbscript>
	
	<dbscript type="sql" id="selectRolesWithNotSelected" resultClass="Role">
		select * from sys_t_role t  where orgnization_id=? and t.state='1' and t.id not in( 
			SELECT r.id FROM sys_t_role r, sys_t_station_role rsr WHERE r.id=rsr.role_id and rsr.station_id=?)
	</dbscript>
	<dbscript type="sql" id="selectPublicRolesWithNotSelected" resultClass="Role">
		select * from sys_t_role r where r.type=? and r.state='1' and r.orgnization_id not in(
			select id from sys_t_orgnization o start with o.id=? 
			connect by PRIOR o.parent_id = o.id) and id not in (SELECT r.id FROM sys_t_role r, sys_t_station_role rsr WHERE r.id=rsr.role_id and rsr.station_id=?)
	</dbscript>
	<dbscript type="sql" id="selectRolesByStationId" resultClass="Role">
		SELECT r.* FROM sys_t_role r, sys_t_station_role rsr WHERE r.state='1' and r.id=rsr.role_id and rsr.station_id=?
	</dbscript>
	<dbscript type="sql" id="selectRolesByStationIdAndConditions" resultClass="Role">
		SELECT r.* FROM sys_t_role r, sys_t_station_role rsr WHERE r.state='1' and r.id=rsr.role_id and rsr.station_id=?
		<ifNotNullCondition property="name">
			and r.name like %name%
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="selectVRolePermissionByRoleId" resultClass="VRolePermission">
		select * from sys_v_role_permissions where role_id=?
	</dbscript>
	<dbscript type="sql" id="selectVRolePermissionByRoleIdAndConditions" resultClass="VRolePermission">
		select * from sys_v_role_permissions where role_id=? 
		<ifNotNullCondition property="name">
			and permission_name like %name%
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="deleteRoleById">
		DELETE FROM sys_t_role WHERE id=?
	</dbscript>
	<dbscript type="sql" id="deleteRolePermissionById">
		DELETE FROM sys_t_role_permission WHERE role_id=? and permission_id=?
	</dbscript>
</dbscripts>
