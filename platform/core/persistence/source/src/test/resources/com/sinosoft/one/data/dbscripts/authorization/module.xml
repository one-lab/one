<?xml version="1.0" encoding="UTF-8"?>
<dbscripts namespace="module" xmlns="http://www.vmars.org/dbscript" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.vmars.org/dbscript ../../../../dbscript.xsd ">
	<typeAlias alias="Module" type="com.sinosoft.emergency.model.authorization.Module"/>
	<dbscript type="sql" id="selectModulesByUserid" resultClass="Module">
		SELECT id, name, code, description, url, parent_id, leaf,creator_id, create_time, modifier_id, modify_time, state, sort FROM sys_v_user_module um 
		WHERE um.user_id=?
		<ifNotNullCondition property="parentId">
			and um.parent_id=#parentId# order by sort asc
		</ifNotNullCondition>
		<elseCondition>
			and um.parent_id is NULL order by sort asc
		</elseCondition>
	</dbscript>
	<dbscript type="sql" id="countModulesByUserIdAndParentId">
		SELECT count(um.id) as count FROM sys_v_user_module um 
		WHERE um.user_id=? 
		<ifNotNullCondition property="parentId">
			and um.parent_id=#parentId#
		</ifNotNullCondition>
		<elseCondition>
			and um.parent_id is NULL
		</elseCondition>
	</dbscript>
	<dbscript type="sql" id="selectModulesByNameAndUrl" resultClass="Module">
		SELECT id, name, code, description, url, parent_id, leaf,creator_id, create_time, modifier_id, modify_time, state, sort FROM sys_t_module um 
		WHERE um.state='1'
		<ifNotNullCondition property="parentId">
			and um.parent_id=#parentId# 
		</ifNotNullCondition>
		<elseCondition>
			and um.parent_id is NULL
		</elseCondition>
		<ifNotNullCondition property="name">
			and um.name like %name%
		</ifNotNullCondition>
		<ifNotNullCondition property="url">
			and um.url like %url%
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="countModulesByNameAndUrl">
		SELECT count(um.id) as count FROM sys_t_module um 
		WHERE um.state='1'
		<ifNotNullCondition property="parentId">
			and um.parent_id=#parentId#
		</ifNotNullCondition>
		<elseCondition>
			and um.parent_id is NULL
		</elseCondition>
		<ifNotNullCondition property="name">
			and um.name like %name%
		</ifNotNullCondition>
		<ifNotNullCondition property="url">
			and um.url like %url%
		</ifNotNullCondition>
	</dbscript>
	<dbscript type="sql" id="countModulesByParentId">
		SELECT count(id) as count FROM sys_t_module 
		WHERE state='1'
		<ifNotNullCondition property="parentId">
			and parent_id = #parentId#
		</ifNotNullCondition>
		<elseCondition>
			and parent_id is null
		</elseCondition>
	</dbscript>
	<dbscript type="sql" id="countSubModulesByParentId">
		SELECT count(id) as count FROM sys_t_module 
		WHERE parent_id=? and state='1'
		<inCondition property="ids">
			and id not in #ids#
		</inCondition>
	</dbscript>
	<dbscript type="sql" id="selectModuleCodeByParentId">
		select to_char(max(code)) from sys_t_module where 
		<ifNotNullCondition property="parentId">
			parent_id=#parentId#
		</ifNotNullCondition>
		<elseCondition>
			parent_id is NULL
		</elseCondition>
	</dbscript>
	<dbscript type="sql" id="selectModuleSortByParentId">
		select to_char(max(sort)) from sys_t_module where 
		<ifNotNullCondition property="parentId">
			parent_id=#parentId#
		</ifNotNullCondition>
		<elseCondition>
			parent_id is NULL
		</elseCondition>
	</dbscript>
	<dbscript type="sql" id="selectModulesByIds" resultClass="Module">
		select * from sys_t_module where state='1'
		<inCondition property="moduleIds">
		and id in #moduleIds#
		</inCondition>
		<simpleNode>
		order by sort asc
		</simpleNode>
	</dbscript>
	<dbscript type="sql" id="selectModulesByParentId" resultClass="Module">
		select * from sys_t_module where state='1'
		<ifNotNullCondition property="parentId">
			and parent_id=#parentId#
		</ifNotNullCondition>
		<elseCondition>
			and parent_id is null
		</elseCondition>
		<simpleNode>
			order by sort asc
		</simpleNode>
	</dbscript>
	<dbscript type="sql" id="updateModuleLeaf">
		update sys_t_module set leaf=? where id=?
	</dbscript>
	<dbscript type="sql" id="deleteModule">
		delete from sys_t_module where id =?
	</dbscript>
</dbscripts>
